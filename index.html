<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vegetable Management System</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ü•¨ Vegetable Management System</h1>
            <div id="user-info" class="user-info hidden">
                <span id="user-name"></span>
                <button id="cart-btn" class="btn btn-primary" style="display: none; position: relative;">
                    Cart <span id="cart-count-badge" style="display: none; position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; line-height: 20px; text-align: center;">0</span>
                </button>
                <button id="orders-btn" class="btn btn-primary" style="display: none;">My Orders</button>
                <button id="user-profile-btn" class="btn btn-primary">Profile</button>
                <button id="logout-btn" class="btn btn-secondary">Logout</button>
            </div>
        </header>

        <!-- Authentication Section -->
        <div id="auth-section" class="auth-section">
            <div class="auth-container">
                <div class="auth-tabs">
                    <button class="tab-btn active" data-tab="login">Login</button>
                    <button class="tab-btn" data-tab="register">Register</button>
                </div>

                <!-- Login Form -->
                <div id="login-form" class="auth-form active">
                    <h2>Login</h2>
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="login-username">Username:</label>
                            <input type="text" id="login-username" required>
                        </div>
                        <div class="form-group">
                            <label for="login-password">Password:</label>
                            <input type="password" id="login-password" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Login</button>
                        <div class="forgot-password">
                            <a href="#" id="forgot-password-link">Forgot Password?</a>
                            <br><br>
                            <small style="color: #666;">Having login issues?</small>
                            <button type="button" class="btn btn-small" onclick="fixJWTSignatureIssue()" style="font-size: 12px; padding: 5px 10px; margin-top: 5px;">Fix Authentication</button>
                        </div>
                    </form>
                </div>

                <!-- Register Form -->
                <div id="register-form" class="auth-form">
                    <h2>Register</h2>
                    <form id="registerForm">
                        <div class="form-group">
                            <label for="register-name">Name:</label>
                            <input type="text" id="register-name" required>
                        </div>
                        <div class="form-group">
                            <label for="register-username">Username:</label>
                            <input type="text" id="register-username" required minlength="3" maxlength="30" pattern="[a-zA-Z0-9_]+" title="Username can only contain letters, numbers, and underscores">
                        </div>
                        <div class="form-group">
                            <label for="register-email">Email:</label>
                            <input type="email" id="register-email" required>
                            <small style="color: #718096; font-size: 12px; display: block; margin-top: 5px;">This email will be used for account verification and password reset</small>
                        </div>
                        <div class="form-group">
                            <label for="register-password">Password:</label>
                            <input type="password" id="register-password" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label>Account Type:</label>
                            <div style="display: flex; gap: 20px; margin-top: 8px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="register-role" value="customer" checked style="margin-right: 8px;">
                                    <span>Customer</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="register-role" value="seller" style="margin-right: 8px;">
                                    <span>Seller</span>
                                </label>
                            </div>
                            <small style="display: block; margin-top: 8px; color: #666; font-size: 12px;">
                                Note: Seller accounts require admin approval before you can start selling.
                            </small>
                        </div>
                        <button type="submit" class="btn btn-primary">Register</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Forgot Password Modal (OTP-based reset, no schema changes) -->
        <div id="forgot-password-modal" class="modal hidden">
            <div class="modal-content" style="max-width: 460px;">
                <span class="close" id="forgot-password-close">&times;</span>
                <h3 style="margin-bottom: 12px;">Forgot Password</h3>

                <!-- Step 1: Request OTP -->
                <div id="forgot-step-request">
                    <p style="font-size: 14px; color: #4a5568; margin-bottom: 10px;">
                        Enter the <strong>email</strong> you used during registration.
                        We will send a 6-digit code to that email address.
                    </p>
                    <form id="forgot-password-request-form">
                        <div class="form-group">
                            <label for="forgot-email">Email</label>
                            <input type="email" id="forgot-email" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Send Code</button>
                        <p style="margin-top: 10px; font-size: 13px; text-align: center;">
                            Prefer a reset link? <a href="#" id="send-reset-link-btn" style="color: #667eea; text-decoration: underline; cursor: pointer;">Send reset link</a>
                        </p>
                    </form>
                </div>

                <!-- Step 2: Reset password with OTP -->
                <div id="forgot-step-reset" class="hidden">
                    <p style="font-size: 14px; color: #4a5568; margin-bottom: 10px;">
                        We sent a 6-digit code to your email. Enter the code and your new password below.
                    </p>
                    <form id="forgot-password-reset-form">
                        <div class="form-group">
                            <label for="forgot-reset-email">Email</label>
                            <input type="email" id="forgot-reset-email" required>
                        </div>
                        <div class="form-group">
                            <label for="forgot-otp">6-digit Code</label>
                            <input type="text" id="forgot-otp" required maxlength="6" pattern="[0-9]{6}">
                        </div>
                        <div class="form-group">
                            <label for="forgot-new-password">New Password</label>
                            <input type="password" id="forgot-new-password" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label for="forgot-new-password-confirm">Confirm New Password</label>
                            <input type="password" id="forgot-new-password-confirm" required minlength="6">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Reset Password</button>
                    </form>
                </div>

                <!-- Step 3: Reset password with token (from link) -->
                <div id="forgot-step-token" class="hidden">
                    <p style="font-size: 14px; color: #4a5568; margin-bottom: 10px;">
                        Enter your new password below to reset your password.
                    </p>
                    <form id="forgot-password-token-form">
                        <div class="form-group">
                            <label for="forgot-token-password">New Password</label>
                            <input type="password" id="forgot-token-password" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label for="forgot-token-password-confirm">Confirm New Password</label>
                            <input type="password" id="forgot-token-password-confirm" required minlength="6">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px; font-size: 16px; font-weight: 600; cursor: pointer; z-index: 10; position: relative;">Reset Password</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Profile Modal (moved outside sections so it's always accessible) -->
        <div id="profile-modal" class="modal hidden">
            <div class="modal-content" style="max-width: 500px;">
                <span class="close" onclick="closeProfileModal()">&times;</span>
                <h3 style="text-align: center; margin-bottom: 20px;">User Profile</h3>
                <div style="text-align: center; margin-bottom: 20px; position: relative;">
                    <img id="profile-avatar" src="https://ui-avatars.com/api/?name=User&size=120&background=6366f1&color=fff&bold=true" 
                         alt="Profile Picture" 
                         style="width: 120px; height: 120px; border-radius: 50%; border: 4px solid #6366f1; object-fit: cover;">
                    <label for="profile-image-input" style="position: absolute; bottom: 0; right: calc(50% - 60px + 40px); background: #6366f1; color: white; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.2);" title="Change Profile Image">
                        <span style="font-size: 18px;">üì∑</span>
                        <input type="file" id="profile-image-input" accept="image/*" style="display: none;" onchange="handleProfileImageUpload(event)">
                    </label>
                </div>
                <div style="background: #f3f4f6; padding: 20px; border-radius: 8px;">
                    <div style="margin-bottom: 15px;">
                        <strong style="color: #374151;">Name:</strong>
                        <p id="profile-name" style="margin: 5px 0; color: #1f2937;">-</p>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong style="color: #374151;">Username:</strong>
                        <p id="profile-username" style="margin: 5px 0; color: #1f2937;">-</p>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong style="color: #374151;">Email:</strong>
                        <p id="profile-email" style="margin: 5px 0; color: #1f2937;">-</p>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong style="color: #374151;">User ID:</strong>
                        <p id="profile-id" style="margin: 5px 0; color: #1f2937;">-</p>
                    </div>
                    <div>
                        <strong style="color: #374151;">Email Verified:</strong>
                        <p id="profile-verified" style="margin: 5px 0; color: #1f2937;">-</p>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="closeProfileModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Admin Section -->
        <div id="admin-section" class="vegetable-section hidden">
            <div class="section-header">
                <h2>Admin Dashboard</h2>
                <div style="display: flex; gap: 10px;">
                    <button id="view-users-btn" class="btn btn-primary">Manage Users</button>
                    <button id="view-sellers-btn" class="btn btn-secondary">View All Sellers</button>
                    <button id="view-vegetables-btn" class="btn btn-secondary">View Vegetables</button>
                </div>
            </div>

            <!-- Users Management Section -->
            <div id="users-section" class="sellers-section" style="display: none;">
                <div class="section-header users-header" style="margin-top: 20px; margin-bottom: 20px;">
                    <h3 style="display: flex; align-items: center; gap: 10px; margin: 0;">
                        <span style="font-size: 24px;">üë•</span>
                        <span>User Management</span>
                    </h3>
                    <div class="users-header-buttons" style="display: flex; gap: 10px;">
                        <button id="create-user-btn" class="btn btn-success">Create New User</button>
                        <button id="admin-dashboard-from-users-btn" class="btn btn-secondary">Dashboard</button>
                    </div>
                </div>
                
                <!-- Search & Filter Section -->
                <div class="users-search-section" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4 style="margin: 0 0 15px 0; color: #1a202c;">Search & Filter Users</h4>
                    <div class="users-search-controls" style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <input type="text" id="user-search" placeholder="Username, email, name..." style="padding: 10px; border-radius: 6px; border: 1px solid #ddd; flex: 1; min-width: 200px; font-size: 14px;">
                        <select id="user-role-filter" style="padding: 10px; border-radius: 6px; border: 1px solid #ddd; font-size: 14px; min-width: 120px;">
                            <option value="">All Roles</option>
                            <option value="customer">Customer</option>
                            <option value="seller">Seller</option>
                            <option value="admin">Admin</option>
                        </select>
                        <button onclick="loadUsers()" class="btn btn-primary" style="padding: 10px 20px; white-space: nowrap;">Search</button>
                    </div>
                </div>
                
                <!-- Users List Table -->
                <div class="users-list-container" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4 style="margin: 0 0 15px 0; color: #1a202c;" id="users-list-title">Users List</h4>
                    <div id="users-list" style="overflow-x: auto;">
                        <!-- Users table will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Create User Modal -->
            <div id="create-user-modal" class="modal hidden">
                <div class="modal-content create-user-modal-content" style="max-width: 500px;">
                    <span class="close" onclick="closeCreateUserModal()" style="cursor: pointer; z-index: 100002; position: absolute; top: 15px; right: 20px;">&times;</span>
                    <h3 style="text-align: center; margin-bottom: 20px;">Create New User</h3>
                    <form id="create-user-form">
                        <div class="form-group">
                            <label for="create-user-name">Name *</label>
                            <input type="text" id="create-user-name" required>
                        </div>
                        <div class="form-group">
                            <label for="create-user-username">Username *</label>
                            <input type="text" id="create-user-username" required minlength="3" maxlength="30" pattern="[a-zA-Z0-9_]+" title="Username can only contain letters, numbers, and underscores">
                        </div>
                        <div class="form-group">
                            <label for="create-user-email">Email *</label>
                            <input type="email" id="create-user-email" required>
                        </div>
                        <div class="form-group">
                            <label for="create-user-password">Password *</label>
                            <input type="password" id="create-user-password" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label>Role *</label>
                            <div class="create-user-role-options" style="display: flex; gap: 20px; margin-top: 8px; flex-wrap: wrap;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="create-user-role" value="customer" checked style="margin-right: 8px;">
                                    <span>Customer</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="create-user-role" value="seller" style="margin-right: 8px;">
                                    <span>Seller</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="create-user-role" value="admin" style="margin-right: 8px;">
                                    <span>Admin</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="create-user-email-verified" style="margin-right: 8px;">
                                Mark email as verified (skip email verification)
                            </label>
                        </div>
                        <div class="form-actions" style="display: flex; justify-content: center; gap: 15px; margin-top: 25px; z-index: 10; position: relative;">
                            <button type="button" class="btn btn-secondary" onclick="closeCreateUserModal()" style="min-width: 120px; z-index: 11; position: relative;">Cancel</button>
                            <button type="submit" class="btn btn-primary" style="min-width: 120px; z-index: 11; position: relative;">Create User</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Sellers List -->
            <div id="sellers-section" class="sellers-section">
                <div class="section-header" style="margin-top: 20px;">
                    <h3>All Seller Accounts</h3>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="seller-search" placeholder="Search sellers..." style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                        <select id="seller-status-filter" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                            <option value="suspended">Suspended</option>
                        </select>
                    </div>
                </div>
                <div id="sellers-list" class="sellers-list">
                    <!-- Sellers will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Vegetable Management Section -->
        <div id="vegetable-section" class="vegetable-section hidden">
            <div class="section-header">
                <h2 id="vegetable-section-title">Vegetable Inventory</h2>
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <!-- Customer navigation buttons -->
                    <button id="browse-sellers-btn" class="btn btn-secondary" style="display: none;">Browse Sellers</button>
                    <button id="view-all-products-btn" class="btn btn-secondary" style="display: none;">View All Products</button>
                    
                    <select id="vegetable-sort" style="padding: 10px 15px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: white; cursor: pointer;">
                        <option value="date-desc">Sort: Newest First</option>
                        <option value="date-asc">Sort: Oldest First</option>
                        <option value="name-asc">Sort: Name A-Z</option>
                        <option value="name-desc">Sort: Name Z-A</option>
                        <option value="price-asc">Sort: Price Low-High</option>
                        <option value="price-desc">Sort: Price High-Low</option>
                        <option value="seller-asc" id="seller-sort-option" style="display: none;">Sort: Seller A-Z</option>
                        <option value="seller-desc" id="seller-sort-desc-option" style="display: none;">Sort: Seller Z-A</option>
                    </select>
                    <select id="vegetable-seller-filter" style="padding: 10px 15px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: white; cursor: pointer; display: none;">
                        <option value="">All Sellers</option>
                    </select>
                    <button id="admin-dashboard-btn" class="btn btn-secondary" style="display: none;">Admin Dashboard</button>
                    <button id="seller-orders-btn" class="btn btn-primary" style="display: none;">View Orders</button>
                    <button id="add-vegetable-btn" class="btn btn-primary">Add New Vegetable</button>
                </div>
            </div>
            
            <!-- Customer Sellers Browse Section -->
            <div id="customer-sellers-section" class="hidden" style="margin-top: 20px;">
                <div class="section-header" style="margin-bottom: 20px;">
                    <h3>Browse Sellers</h3>
                    <input type="text" id="customer-seller-search" placeholder="Search sellers..." style="padding: 8px 15px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; width: 300px;">
                </div>
                <div id="customer-sellers-list" class="sellers-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
                    <!-- Sellers will be loaded here -->
                </div>
            </div>

            <!-- Add/Edit Vegetable Modal -->
            <div id="vegetable-modal" class="modal hidden">
                <div class="modal-content">
                    <span id="close-vegetable-modal" class="close" style="cursor: pointer; z-index: 100002; position: absolute; top: 15px; right: 20px;">&times;</span>
                    <h3 id="modal-title">Add New Vegetable</h3>
                    <form id="vegetableForm" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="vegetable-name">Name:</label>
                            <input type="text" id="vegetable-name" required>
                        </div>
                        <div class="form-group">
                            <label for="vegetable-price">Price per kilo (‚Ç±/kg):</label>
                            <input type="number" id="vegetable-price" step="0.01" min="0" required placeholder="e.g., 25.99">
                            <small style="color: #718096; font-size: 12px; display: block; margin-top: 5px;">Enter the price per kilogram</small>
                        </div>
                        <div class="form-group">
                            <label for="vegetable-stock">Stock Quantity (kg):</label>
                            <input type="number" id="vegetable-stock" step="1" min="0" required placeholder="e.g., 50">
                            <small style="color: #718096; font-size: 12px; display: block; margin-top: 5px;">Enter the available stock in kilograms</small>
                        </div>
                        <div class="form-group">
                            <label for="vegetable-description">Description:</label>
                            <textarea id="vegetable-description" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="vegetable-image">Image:</label>
                            <input type="file" id="vegetable-image" accept="image/*">
                            <small>Upload an image (JPG, PNG, GIF) - Max 5MB</small>
                        </div>
                        <div class="form-actions" style="justify-content: center; gap: 15px; margin-top: 25px;">
                            <button type="button" id="cancel-btn" class="btn btn-secondary" style="min-width: 120px;">Cancel</button>
                            <button type="submit" class="btn btn-primary" style="min-width: 120px;">Save</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Vegetables List -->
            <div id="vegetables-list" class="vegetables-grid">
                <!-- Vegetables will be loaded here -->
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
        </div>

        <!-- Message Display -->
        <div id="message" class="message hidden"></div>

        <!-- Cart Modal -->
        <div id="cart-modal" class="modal hidden">
            <div class="modal-content" style="max-width: 700px;">
                <span class="close" onclick="closeCartModal()" style="cursor: pointer; z-index: 100002; position: absolute; top: 15px; right: 20px;">&times;</span>
                <h3 style="text-align: center; margin-bottom: 20px;">Shopping Cart</h3>
                <div id="cart-items-container" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;">
                    <!-- Cart items will be loaded here -->
                </div>
                <div style="border-top: 2px solid #e2e8f0; padding-top: 15px; margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <strong style="font-size: 18px;">Total:</strong>
                        <strong style="font-size: 20px; color: #667eea;" id="cart-total">‚Ç±0.00</strong>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" onclick="closeCartModal()" style="flex: 1;">Continue Shopping</button>
                        <button class="btn btn-primary" onclick="openCheckoutModal()" id="checkout-btn" style="flex: 1;" disabled>Checkout</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add to Cart Quantity Modal -->
        <div id="quantity-modal" class="modal hidden">
            <div class="modal-content" style="max-width: 400px;">
                <span class="close" onclick="closeQuantityModal()" style="cursor: pointer; z-index: 100002; position: absolute; top: 15px; right: 20px;">&times;</span>
                <h3 style="text-align: center; margin-bottom: 20px;">Add to Cart</h3>
                <div style="text-align: center; margin-bottom: 20px;">
                    <p id="quantity-product-name" style="color: #4a5568; font-size: 16px; margin-bottom: 10px;"></p>
                    <p style="color: #718096; font-size: 14px; margin-bottom: 20px;">Enter the quantity you want to purchase</p>
                </div>
                <form id="quantity-form" onsubmit="handleQuantitySubmit(event)">
                    <div class="form-group">
                        <label for="quantity-input">Quantity (kg):</label>
                        <input type="number" id="quantity-input" step="0.01" min="0.01" required placeholder="e.g., 0.5, 1.25, 2" style="text-align: center; font-size: 18px; padding: 12px;" oninput="updateQuantityConversion(); updatePriceCalculation();">
                        <div id="quantity-conversion" style="margin-top: 10px; padding: 10px; background: #f3f4f6; border-radius: 8px; text-align: center;">
                            <p style="margin: 0; color: #4a5568; font-size: 14px; font-weight: 600;" id="conversion-text">0 kg = 0 grams</p>
                        </div>
                        <div id="price-calculation" style="margin-top: 10px; padding: 12px; background: #e0e7ff; border-radius: 8px; text-align: center; border: 2px solid #667eea;">
                            <p style="margin: 0; color: #1e40af; font-size: 14px; font-weight: 600;" id="price-text">Price: ‚Ç±0.00</p>
                            <p style="margin: 5px 0 0; color: #4b5563; font-size: 12px;" id="price-breakdown">‚Ç±0.00 per kg √ó 0 kg</p>
                        </div>
                        <small style="color: #718096; font-size: 12px; display: block; margin-top: 5px; text-align: center;">You can enter decimal values (e.g., 0.5 kg, 1.25 kg)</small>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 25px;">
                        <button type="button" class="btn btn-secondary" onclick="closeQuantityModal()" style="flex: 1;">Cancel</button>
                        <button type="submit" class="btn btn-primary" style="flex: 1;">Add to Cart</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Checkout Modal -->
        <div id="checkout-modal" class="modal hidden">
            <div class="modal-content" style="max-width: 600px;">
                <span class="close" onclick="closeCheckoutModal()" style="cursor: pointer; z-index: 100002; position: absolute; top: 15px; right: 20px;">&times;</span>
                <h3 style="text-align: center; margin-bottom: 20px;">Checkout</h3>
                <form id="checkout-form">
                    <div id="saved-address-notice" style="display: none; background: #e0e7ff; border: 1px solid #667eea; border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 16px;">üìã</span>
                                <span style="color: #1e40af; font-size: 13px; font-weight: 500;">Using your last saved address</span>
                            </div>
                            <button type="button" onclick="clearSavedAddress()" style="background: transparent; border: none; color: #667eea; cursor: pointer; font-size: 12px; text-decoration: underline; padding: 4px 8px;">Clear</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="shipping-barangay">Barangay *</label>
                        <div style="position: relative;">
                            <input type="text" id="shipping-barangay" required placeholder="Type to search barangay..." autocomplete="off" style="width: 100%; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 14px;">
                            <div id="barangay-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #e2e8f0; border-radius: 10px; max-height: 200px; overflow-y: auto; z-index: 1000; margin-top: 5px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                                <!-- Barangay options will be populated here -->
                            </div>
                        </div>
                        <small style="color: #718096; font-size: 12px;">Start typing to filter barangays</small>
                    </div>
                    <div class="form-group">
                        <label for="shipping-address">Street Address / House Number *</label>
                        <textarea id="shipping-address" required placeholder="Enter your street address, house number, or landmark"></textarea>
                    </div>
                    <div class="form-group" style="display: none;">
                        <input type="hidden" id="shipping-city" value="Sinacaban">
                        <input type="hidden" id="shipping-state" value="Misamis Occidental">
                        <input type="hidden" id="shipping-country" value="Philippines">
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <div style="background: #f7fafc; padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0;">
                            <p style="margin: 0; color: #4a5568; font-size: 14px;"><strong>Municipality:</strong> Sinacaban</p>
                            <p style="margin: 0; color: #4a5568; font-size: 14px;"><strong>Province:</strong> Misamis Occidental</p>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="payment-method">Payment Method</label>
                        <select id="payment-method" style="padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; width: 100%;" disabled>
                            <option value="cash_on_delivery" selected>Cash on Delivery (COD) - Only Available Payment Method</option>
                        </select>
                        <small style="color: #718096; font-size: 12px;">Currently, we only accept Cash on Delivery for orders within Sinacaban</small>
                    </div>
                    <div class="form-group">
                        <label for="order-notes">Order Notes (Optional)</label>
                        <textarea id="order-notes" placeholder="Any special instructions for delivery..."></textarea>
                    </div>
                    <div style="border-top: 2px solid #e2e8f0; padding-top: 15px; margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <strong style="font-size: 18px;">Total Amount:</strong>
                            <strong style="font-size: 20px; color: #667eea;" id="checkout-total">‚Ç±0.00</strong>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="button" class="btn btn-secondary" onclick="closeCheckoutModal()" style="flex: 1;">Cancel</button>
                            <button type="submit" class="btn btn-primary" style="flex: 1;">Place Order</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Orders Modal -->
        <div id="orders-modal" class="modal hidden">
            <div class="modal-content" style="max-width: 900px;">
                <span class="close" onclick="closeOrdersModal()" style="cursor: pointer; z-index: 100002; position: absolute; top: 15px; right: 20px;">&times;</span>
                <h3 style="text-align: center; margin-bottom: 20px;">My Orders</h3>
                <div id="orders-container" style="max-height: 600px; overflow-y: auto;">
                    <!-- Orders will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Order Details Modal -->
        <div id="order-details-modal" class="modal hidden">
            <div class="modal-content" style="max-width: 700px;">
                <span class="close" onclick="closeOrderDetailsModal()" style="cursor: pointer; z-index: 100002; position: absolute; top: 15px; right: 20px;">&times;</span>
                <h3 style="text-align: center; margin-bottom: 20px;">Order Details</h3>
                <div id="order-details-container">
                    <!-- Order details will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Seller Orders Section -->
        <div id="seller-orders-section" class="hidden" style="display: none; margin-top: 20px; background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 30px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1); backdrop-filter: blur(10px); position: relative; z-index: 1;">
            <div class="section-header" style="margin-bottom: 20px;">
                <h3>My Orders</h3>
                <button id="back-to-vegetables-btn" class="btn btn-secondary">Back to Vegetables</button>
            </div>
            <div id="seller-orders-container" style="max-height: 600px; overflow-y: auto;">
                <!-- Seller orders will be loaded here -->
            </div>
        </div>

        <!-- Custom Confirmation Modal -->
        <div id="confirm-modal" class="modal hidden">
            <div class="modal-content" style="max-width: 450px; pointer-events: auto;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="width: 60px; height: 60px; margin: 0 auto 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <span style="font-size: 30px;">‚ö†Ô∏è</span>
                    </div>
                    <h3 id="confirm-title" style="margin-bottom: 15px; color: #4a5568; font-size: 1.5rem;">Confirm Action</h3>
                </div>
                <p id="confirm-message" style="margin-bottom: 30px; color: #718096; line-height: 1.6; text-align: center; font-size: 15px;"></p>
                <div class="form-actions" style="justify-content: center; gap: 15px; position: relative; z-index: 100002;">
                    <button id="confirm-cancel" class="btn btn-secondary" style="min-width: 100px; position: relative; z-index: 100003; cursor: pointer;">Cancel</button>
                    <button id="confirm-ok" class="btn btn-primary" style="min-width: 100px; position: relative; z-index: 100003; cursor: pointer;">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="js/script.js"></script>
</body>
</html>
